{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import chatAPI from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{// Check if user is already logged in\nconst storedUser=localStorage.getItem('chatUser');if(storedUser){try{const parsedUser=JSON.parse(storedUser);setUser(parsedUser);}catch(err){console.error('Failed to parse stored user:',err);localStorage.removeItem('chatUser');}}setLoading(false);},[]);const login=async email=>{try{setError(null);setLoading(true);const result=await chatAPI.loginUser(email);if('ok'in result){const userData=result.ok;setUser(userData);localStorage.setItem('chatUser',JSON.stringify(userData));return{success:true,user:userData};}else{const errorMsg=result.err;setError(errorMsg);return{success:false,error:errorMsg};}}catch(err){const errorMsg=err.message||'Login failed';setError(errorMsg);return{success:false,error:errorMsg};}finally{setLoading(false);}};const register=async(email,name,otpCode)=>{try{setError(null);setLoading(true);const result=await chatAPI.registerUser(email,name,otpCode);if('ok'in result){const userData=result.ok;setUser(userData);localStorage.setItem('chatUser',JSON.stringify(userData));return{success:true,user:userData};}else{const errorMsg=result.err;setError(errorMsg);return{success:false,error:errorMsg};}}catch(err){const errorMsg=err.message||'Registration failed';setError(errorMsg);return{success:false,error:errorMsg};}finally{setLoading(false);}};const generateOTP=async email=>{try{setError(null);const result=await chatAPI.generateOTP(email);if('ok'in result){return{success:true,code:result.ok};}else{const errorMsg=result.err;setError(errorMsg);return{success:false,error:errorMsg};}}catch(err){const errorMsg=err.message||'Failed to generate OTP';setError(errorMsg);return{success:false,error:errorMsg};}};const logout=async()=>{try{if(user){await chatAPI.logoutUser(user.id);}}catch(err){console.error('Logout error:',err);}finally{setUser(null);localStorage.removeItem('chatUser');}};const value={user,loading,error,login,register,generateOTP,logout,setError};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","chatAPI","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","error","setError","storedUser","localStorage","getItem","parsedUser","JSON","parse","err","console","removeItem","login","email","result","loginUser","userData","ok","setItem","stringify","success","errorMsg","message","register","name","otpCode","registerUser","generateOTP","code","logout","logoutUser","id","value","Provider"],"sources":["/Users/ridhoauliarahman/Library/CloudStorage/GoogleDrive-ridho.aulia7324@gmail.com/My Drive/ICP/icp-chat-app/src/frontend/src/hooks/useAuth.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport chatAPI from '../services/api';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    // Check if user is already logged in\n    const storedUser = localStorage.getItem('chatUser');\n    if (storedUser) {\n      try {\n        const parsedUser = JSON.parse(storedUser);\n        setUser(parsedUser);\n      } catch (err) {\n        console.error('Failed to parse stored user:', err);\n        localStorage.removeItem('chatUser');\n      }\n    }\n    setLoading(false);\n  }, []);\n\n  const login = async (email) => {\n    try {\n      setError(null);\n      setLoading(true);\n      \n      const result = await chatAPI.loginUser(email);\n      \n      if ('ok' in result) {\n        const userData = result.ok;\n        setUser(userData);\n        localStorage.setItem('chatUser', JSON.stringify(userData));\n        return { success: true, user: userData };\n      } else {\n        const errorMsg = result.err;\n        setError(errorMsg);\n        return { success: false, error: errorMsg };\n      }\n    } catch (err) {\n      const errorMsg = err.message || 'Login failed';\n      setError(errorMsg);\n      return { success: false, error: errorMsg };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const register = async (email, name, otpCode) => {\n    try {\n      setError(null);\n      setLoading(true);\n      \n      const result = await chatAPI.registerUser(email, name, otpCode);\n      \n      if ('ok' in result) {\n        const userData = result.ok;\n        setUser(userData);\n        localStorage.setItem('chatUser', JSON.stringify(userData));\n        return { success: true, user: userData };\n      } else {\n        const errorMsg = result.err;\n        setError(errorMsg);\n        return { success: false, error: errorMsg };\n      }\n    } catch (err) {\n      const errorMsg = err.message || 'Registration failed';\n      setError(errorMsg);\n      return { success: false, error: errorMsg };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const generateOTP = async (email) => {\n    try {\n      setError(null);\n      \n      const result = await chatAPI.generateOTP(email);\n      \n      if ('ok' in result) {\n        return { success: true, code: result.ok };\n      } else {\n        const errorMsg = result.err;\n        setError(errorMsg);\n        return { success: false, error: errorMsg };\n      }\n    } catch (err) {\n      const errorMsg = err.message || 'Failed to generate OTP';\n      setError(errorMsg);\n      return { success: false, error: errorMsg };\n    }\n  };\n\n  const logout = async () => {\n    try {\n      if (user) {\n        await chatAPI.logoutUser(user.id);\n      }\n    } catch (err) {\n      console.error('Logout error:', err);\n    } finally {\n      setUser(null);\n      localStorage.removeItem('chatUser');\n    }\n  };\n\n  const value = {\n    user,\n    loading,\n    error,\n    login,\n    register,\n    generateOTP,\n    logout,\n    setError\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}