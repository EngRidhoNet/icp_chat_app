{"ast":null,"code":"import React,{useState}from'react';import{useNavigate,useLocation}from'react-router-dom';import{useAuth}from'../../hooks/useAuth';import{validateOTP}from'../../utils/helpers';import'./Auth.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const OTPVerification=()=>{const navigate=useNavigate();const location=useLocation();const{register,generateOTP}=useAuth();const{email,name,isRegister}=location.state||{};const[otp,setOtp]=useState('');const[isLoading,setIsLoading]=useState(false);const[error,setError]=useState('');const[message,setMessage]=useState('');const handleOtpChange=e=>{const value=e.target.value.replace(/\\D/g,'').slice(0,6);setOtp(value);setError('');};const verifyOTP=async()=>{try{setIsLoading(true);setError('');// Validate OTP format\nif(!validateOTP(otp)){setError('Please enter a valid 6-digit OTP');return;}if(isRegister){// Register user\nconst result=await register(email,name,otp);if(result.success){setMessage('Registration successful! Redirecting to chat...');setTimeout(()=>{navigate('/chat');},1500);}else{setError(result.error);}}}catch(error){console.error('❌ Verify OTP error:',error);setError('Failed to verify OTP. Please try again.');}finally{setIsLoading(false);}};const handleSubmit=async e=>{e.preventDefault();await verifyOTP();};const resendOTP=async()=>{try{setIsLoading(true);setError('');setMessage('');const result=await generateOTP(email);if(result.success){alert(`New OTP Generated!\\n\\nEmail: ${email}\\nOTP: ${result.otp}\\n\\nCheck browser console for details.`);setMessage('New OTP generated! Check browser console and the alert above.');setOtp('');}else{setError(result.error);}}catch(error){console.error('❌ Resend OTP error:',error);setError('Failed to resend OTP. Please try again.');}finally{setIsLoading(false);}};const goBack=()=>{navigate(-1);};if(!email){return/*#__PURE__*/_jsx(\"div\",{className:\"auth-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"auth-card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Error\"}),/*#__PURE__*/_jsx(\"p\",{children:\"No email provided. Please go back and try again.\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"auth-button\",onClick:()=>navigate('/register'),children:\"Back to Register\"})]})});}return/*#__PURE__*/_jsx(\"div\",{className:\"auth-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"auth-card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Verify OTP\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"auth-description\",children:[\"Enter the 6-digit code sent to:\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:email})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),message&&/*#__PURE__*/_jsx(\"div\",{className:\"success-message\",children:message}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:otp,onChange:handleOtpChange,placeholder:\"Enter 6-digit OTP\",maxLength:\"6\",className:\"otp-input\",required:true,autoFocus:true}),/*#__PURE__*/_jsx(\"small\",{className:\"form-help\",children:\"OTP is shown in browser console and alert popup\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"auth-button\",disabled:isLoading||otp.length!==6,children:isLoading?'Verifying...':'Verify OTP'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"auth-links\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"link-button\",onClick:resendOTP,disabled:isLoading,children:\"Resend OTP\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"link-button\",onClick:goBack,children:\"Back\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"auth-help\",children:/*#__PURE__*/_jsxs(\"small\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Development Mode:\"}),\" OTP is displayed in browser console and alert popup.\"]})})]})});};export default OTPVerification;","map":{"version":3,"names":["React","useState","useNavigate","useLocation","useAuth","validateOTP","jsx","_jsx","jsxs","_jsxs","OTPVerification","navigate","location","register","generateOTP","email","name","isRegister","state","otp","setOtp","isLoading","setIsLoading","error","setError","message","setMessage","handleOtpChange","e","value","target","replace","slice","verifyOTP","result","success","setTimeout","console","handleSubmit","preventDefault","resendOTP","alert","goBack","className","children","type","onClick","onSubmit","onChange","placeholder","maxLength","required","autoFocus","disabled","length"],"sources":["/Users/ridhoauliarahman/Library/CloudStorage/GoogleDrive-ridho.aulia7324@gmail.com/My Drive/ICP/icp-chat-app/src/frontend/src/components/Auth/OTPVerification.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useAuth } from '../../hooks/useAuth';\nimport { validateOTP } from '../../utils/helpers';\nimport './Auth.css';\n\nconst OTPVerification = () => {\n    const navigate = useNavigate();\n    const location = useLocation();\n    const { register, generateOTP } = useAuth();\n    const { email, name, isRegister } = location.state || {};\n    \n    const [otp, setOtp] = useState('');\n    const [isLoading, setIsLoading] = useState(false);\n    const [error, setError] = useState('');\n    const [message, setMessage] = useState('');\n\n    const handleOtpChange = (e) => {\n        const value = e.target.value.replace(/\\D/g, '').slice(0, 6);\n        setOtp(value);\n        setError('');\n    };\n\n    const verifyOTP = async () => {\n        try {\n            setIsLoading(true);\n            setError('');\n\n            // Validate OTP format\n            if (!validateOTP(otp)) {\n                setError('Please enter a valid 6-digit OTP');\n                return;\n            }\n\n            if (isRegister) {\n                // Register user\n                const result = await register(email, name, otp);\n                \n                if (result.success) {\n                    setMessage('Registration successful! Redirecting to chat...');\n                    setTimeout(() => {\n                        navigate('/chat');\n                    }, 1500);\n                } else {\n                    setError(result.error);\n                }\n            }\n        } catch (error) {\n            console.error('❌ Verify OTP error:', error);\n            setError('Failed to verify OTP. Please try again.');\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        await verifyOTP();\n    };\n\n    const resendOTP = async () => {\n        try {\n            setIsLoading(true);\n            setError('');\n            setMessage('');\n\n            const result = await generateOTP(email);\n            \n            if (result.success) {\n                alert(`New OTP Generated!\\n\\nEmail: ${email}\\nOTP: ${result.otp}\\n\\nCheck browser console for details.`);\n                setMessage('New OTP generated! Check browser console and the alert above.');\n                setOtp('');\n            } else {\n                setError(result.error);\n            }\n        } catch (error) {\n            console.error('❌ Resend OTP error:', error);\n            setError('Failed to resend OTP. Please try again.');\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const goBack = () => {\n        navigate(-1);\n    };\n\n    if (!email) {\n        return (\n            <div className=\"auth-container\">\n                <div className=\"auth-card\">\n                    <h2>Error</h2>\n                    <p>No email provided. Please go back and try again.</p>\n                    <button \n                        type=\"button\" \n                        className=\"auth-button\"\n                        onClick={() => navigate('/register')}\n                    >\n                        Back to Register\n                    </button>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"auth-container\">\n            <div className=\"auth-card\">\n                <h2>Verify OTP</h2>\n                <p className=\"auth-description\">\n                    Enter the 6-digit code sent to:<br />\n                    <strong>{email}</strong>\n                </p>\n                \n                {error && <div className=\"error-message\">{error}</div>}\n                {message && <div className=\"success-message\">{message}</div>}\n\n                <form onSubmit={handleSubmit}>\n                    <div className=\"form-group\">\n                        <input\n                            type=\"text\"\n                            value={otp}\n                            onChange={handleOtpChange}\n                            placeholder=\"Enter 6-digit OTP\"\n                            maxLength=\"6\"\n                            className=\"otp-input\"\n                            required\n                            autoFocus\n                        />\n                        <small className=\"form-help\">\n                            OTP is shown in browser console and alert popup\n                        </small>\n                    </div>\n\n                    <button \n                        type=\"submit\" \n                        className=\"auth-button\"\n                        disabled={isLoading || otp.length !== 6}\n                    >\n                        {isLoading ? 'Verifying...' : 'Verify OTP'}\n                    </button>\n                </form>\n\n                <div className=\"auth-links\">\n                    <button \n                        type=\"button\" \n                        className=\"link-button\"\n                        onClick={resendOTP}\n                        disabled={isLoading}\n                    >\n                        Resend OTP\n                    </button>\n                    \n                    <button \n                        type=\"button\" \n                        className=\"link-button\"\n                        onClick={goBack}\n                    >\n                        Back\n                    </button>\n                </div>\n\n                <div className=\"auth-help\">\n                    <small>\n                        <strong>Development Mode:</strong> OTP is displayed in browser console and alert popup.\n                    </small>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default OTPVerification;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}